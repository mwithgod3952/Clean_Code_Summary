# i made the definition to scrap website online
def scraping(search_word):
    global fl_tlt_lst_n, fl_brd_lst_n, fl_src_lst_n
    
    options = Options()
    ua = UserAgent()
    userAgent = ua.random
    print(userAgent)
    
    options.add_argument('headless')
    options.add_argument('window-size=1920x1080')
    options.add_argument("disable-gpu")
    options.add_argument(f'user-agent={userAgent}')
    wd = webdriver.Chrome(ChromeDriverManager().install())#, chrome_options=options)
    
    socket.setdefaulttimeout(30)
    
    try:    
        url = 'https://www.glowpick.com/searches/keywords'
        wd.get(url)
        time.sleep(5)

        # 해당 웹페이지 접속 시 팝업창 생성으로 인한 스크레핑 오류를 피하기 위하여 xpath click 코드라인 추가     
        wd.find_element_by_xpath("//*[@id='default-layout']/div/div[1]/span/div/div[2]/div[2]/button[2]").click()

        # 크롤링 할 수 있는 이미지 수 최대 확보를 위한 window 화면크기 최대화     
        wd.maximize_window()
        time.sleep(2)

        # 이미지 검색을 윟나 상품명 입력     
        search_box = wd.find_element_by_xpath("//*[@id='default-layout']/div/div[2]/div/div/div/input")
        #search_box.send_keys(search_word)
        search_box.send_keys("아던샵 속눈썹")
        search_box.send_keys(Keys.ENTER)

        # 모든 정보를 불러오기 위한 스크롤 다운
        time.sleep(2)

        while True:
          
            fl_src_lst = []
         
            
            html = wd.page_source
            soup = soup = BeautifulSoup(html,"html.parser")
            product_list = soup.select('.products__product.product')
            print(len(product_list))
            element = wd.find_element_by_xpath('/html/body/div/div/div/div/main/div/section/div[2]/div/div[1]/span/div[{}]'.format(len(product_list)-1))

            wd.execute_script("arguments[0].scrollIntoView(true);", element)
            time.sleep(4)
            html = wd.page_source
            soup = soup = BeautifulSoup(html,"html.parser")
            product_list_2 = soup.select('.products__product.product')
            print(len(product_list_2))
            
            if product_list == product_list_2:
                html = wd.page_source
                soup = soup = BeautifulSoup(html,"html.parser")
                product_img = soup.select('.products__product.product')
                print(product_img)
                for div1 in product_img:
                    img_src = div1.img
                    try:
                        img_src_r= img_src['src'].replace("?w=120","?w=500")
                        fl_src_lst.append(img_src_r)
                    except KeyError:
                        fl_src_lst.append("")          
                brand_lst = soup.select('.details__brand__title')
                product_lst = soup.select('.details__product')  
                fl_brd_lst_n = [x.text for x in brand_lst]
                fl_tlt_lst_n= [x.text for x in product_lst]
                fl_src_lst_n = fl_src_lst
                print(fl_src_lst_n)
                ind = [x for x in range(len(fl_src_lst_n)) if fl_src_lst_n[x] == '']
                
                for i in ind:                         
                    element = wd.find_element_by_xpath('/html/body/div/div/div/div/main/div/section/div[2]/div/div[1]/span/div[{}]'.format(i-1))
                    wd.execute_script("arguments[0].scrollIntoView(true);", element)
                    time.sleep(2)
                    wd.find_element_by_xpath('/html/body/div/div/div/div/main/div/section/div[2]/div/div[1]/span/div[{}]'.format(i+1)).click()
                    time.sleep(3)
                    html = wd.page_source
                    soup = soup = BeautifulSoup(html,"html.parser")
                    drop_img_lst = soup.select('.image__img')
                    drop_img = drop_img_lst[1]
                    img__src= drop_img['src']
                    img__src_r= img__src.replace("?w=456","?w=500")
                   
                    fl_src_lst_n[i]=img__src_r
                    wd.back()
                    time.sleep(5)  
                break
            
    except NoSuchElementException:
        pass
    except:
        ind = [x for x in range(len(fl_src_lst_n)) if fl_src_lst_n[x] != '']
        fl_src_lst_n= [fl_src_lst_n[x] for x in ind]
        fl_tlt_lst_n= [fl_tlt_lst_n[x] for x in ind]
        fl_brd_lst_n= [fl_brd_lst_n[x] for x in ind]
        
